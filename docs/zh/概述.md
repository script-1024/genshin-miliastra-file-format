# 概述

### 编码方式
- 使用了 Protocol Buffers（简称 Protobuf）对数据进行序列化和反序列化。如果你不知道这是什么，建议参考[官方文档](https://protobuf.dev/programming-guides/encoding/)，或者看看[简介](/docs/zh/Protobuf%20简介.md)。
- 字符串以 UTF-8 格式编码。

## 文件元信息
无论是 `.gip`(Project), `.gil`(Level), `.gia`(Asset), 还是 `.gir`(Runtime) 文件，它们都拥有类似的结构：

```
(开始)
[文件大小：4 字节]
[版本编号：4 字节]
[头部标记：4 字节]
[文件类型：4 字节]
[内容长度：4 字节]

(内容负载：任意长度)

[尾部标记：4 字节]
(结束)
```

可以被这样表示：

```c#
public enum GiFileType {
    Unknown = 0,
    Gip = 1,
    Gil = 2,
    Gia = 3,
    Gir = 4
}

public abstract class GiFile {
    // 版本编号
    public uint Version { get; protected set; }
    // 文件类型
    public GiFileType Type { get; }
    // 头部魔数（用于校验）
    public uint HeadMagicNumber => 0x0326;
    // 尾部魔数（用于校验）
    public uint TailMagicNumber => 0x0679;
}
```

这些字段以大端序保存，下方将详细介绍它们的含义和用途。

### 文件大小
- 偏移：`0x00`
- 文件真实大小减去 4 个字节（即不包含尾部标记的 4 字节）。

### 版本编号
- 偏移：`0x04`
- 截止至原神 V6.1 (Luna II) 版本，这个字段总是被设置为 `00 00 00 01`。
- 经测试，就算设置成其他数值也能被正常加载，但建议和官方保持一致。

### 头部标记
- 偏移：`0x08`
- 数值：`00 00 03 26`
- ⚠️ **此字段被游戏严格校验，任何其他值都将被拒绝加载**。

### 文件类型
- 偏移：`0x0C`
- 一个枚举，表示这个文件的类型，接受值如下：
  - GIP = `00 00 00 01`
  - GIL = `00 00 00 02`
  - GIA = `00 00 00 03`
  - GIR = `00 00 00 04`

### 内容长度
- 偏移：`0x10`
- 文件真实大小减去 24 个字节（即不包含头部固定的 20 字节和用作尾部标记的 4 字节）。

### 内容负载
请见对应介绍页面：🔗[链接](/docs/zh/内容负载.md)

### 尾部标记
- 偏移：`文件大小` 字段的值
- 数值：`00 00 06 79`
- ⚠️ **此字段被游戏严格校验，任何其他值都将被拒绝加载**。

## 你知道吗？
这是一个最小的合法 GIA 文件示例，它能够通过游戏校验不会报错，却不会在资产管理界面上留下任何痕迹！🤪

```
00 00 00 14 00 00 00 01 00 00 03 26 00 00 00 03 00 00 00 00 00 00 06 79
```

| 字段   | 数值        | 说明    |
|:-----:|:-----------:|:------:|
|文件大小|`00 00 00 14`|14 字节  |
|版本编号|`00 00 00 01`|1       |
|头部标记|`00 00 03 26`|正确 ✅ |
|文件类型|`00 00 00 03`|GIA 文件|
|内容长度|`00 00 00 00`|0 字节  |
|内容负载|-------------|无      |
|尾部标记|`00 00 06 79`|正确 ✅ |
